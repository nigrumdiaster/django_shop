{% extends "base.html" %}
{% load static %}

{% block title %}
{{ title }}
{% endblock title %}

{% block content%}
<div class="ltn__utilize-overlay"></div>
<div class="ltn__breadcrumb-area ltn__breadcrumb-area-4 ltn__breadcrumb-color-white---">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="ltn__breadcrumb-inner text-center">
                    <h1 class="ltn__page-title">Chuyên Mục: {{ tenchuyenmuc }}</h1>
                    <div class="ltn__breadcrumb-list">
                        <ul>
                            <li><a href="{% url 'home' %}">Trang Chủ</a></li>
                            <li><a href="{% url 'category' %}">Chuyên Mục</a></li>
                            <li><a href="#">{{ tenchuyenmuc }}</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ltn__product-area mb-100">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="ltn__shop-options">
                    <ul>
                        <li>
                           <div class="showing-product-number text-right">
                                <span>Chuyên mục có {{ sanpham.count }} sản phẩm</span>
                            </div> 
                        </li>
                        <li>
                           <div class="short-by text-center">
                                <select class="nice-select" style="display: none;">
                                    <option>Mặc Định</option>
                                    <option>Sắp Xếp Giá Tăng</option>
                                    <option>Sắp Xếp Giá Giảm</option>
                                    <option>Mới Nhất</option>
                                </select>
                                <div class="nice-select" tabindex="0">
                                    <span class="current">Mặc Định</span>
                                    <ul class="list">
                                        <li data-value="Default sorting" class="option selected"><a href="" class="sx_tang">Sắp Xếp Giá Tăng</a></li>
                                        <li data-value="Sort by popularity" class="option"><a href="" class="sx_giam">Sắp Xếp Giá Giảm</a></li>
                                        <li data-value="Sort by new arrivals" class="option"><a href="" class="sx_moi">Mới Nhất</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="ltn__grid-list-tab-menu ">
                                <div class="nav">
                                    <a class="show active" data-bs-toggle="tab" href="#liton_product_grid"><i class="icon-grid"></i></a>
                                    <a data-bs-toggle="tab" href="#liton_product_list" class=""><i class="icon-menu"></i></a>
                                </div>
                            </div> 
                        </li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div class="tab-pane fade active show" id="liton_product_grid">
                        <div class="ltn__product-tab-content-inner ltn__product-grid-view">
                            <div class="row">

                                {% for item in sanpham %}
                                <div class="col-xl-3 col-lg-4 col-sm-6 col-12">
                                    <div class="ltn__product-item text-center">
                                        <div class="product-img">
                                            <a href="{% url 'detail_product' slug=item.DuongDan %}"><img style="height: 300px; image-rendering: -webkit-optimize-contrast;" src="{{ item.AnhChinh.url }}" alt="#"></a>
                                            <div class="product-badge">
                                                <ul>
                                                    <li class="badge-1">- {{ item.PhanTramGiam }}%</li>
                                                </ul>
                                            </div>
                                            <div class="product-hover-action product-hover-action-2">
                                                <ul>
                                                    <li class="add-to-cart">
                                                        <a href="#" title="Add to Cart" data-bs-toggle="modal" data-bs-target="#add_to_cart_modal">
                                                            <span class="{{ item.id }} cart-text d-none d-xl-block">THÊM GIỎ HÀNG</span>
                                                            <span class="d-block d-xl-none"><i class="icon-handbag"></i></span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="product-info">
                                            <h2 class="product-title"><a href="{% url 'detail_product' slug=item.DuongDan %}">{{ item.TenSanPham }}</a></h2>
                                            <div class="product-price">
                                                <span>{{ item.GiaBan }}đ</span>
                                                <del>{{ item.GiaKhuyenMai }}đ</del>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="liton_product_list">
                        <div class="ltn__product-tab-content-inner ltn__product-list-view">
                            <div class="row">
                                
                                {% for item in sanpham %}
                                <div class="col-lg-12">
                                    <div class="ltn__product-item">
                                        <div class="product-img">
                                            <a href="{% url 'detail_product' slug=item.DuongDan %}"><img style="width: 287px; height: 300px; image-rendering: -webkit-optimize-contrast;" src="{{ item.AnhChinh.url }}" alt="#"></a>
                                            <div class="product-badge">
                                                <ul>
                                                    <li class="badge-1">- {{ item.PhanTramGiam }}%</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="product-info">
                                            <h2 class="product-title"><a href="{% url 'detail_product' slug=item.DuongDan %}">{{ item.TenSanPham }}</a></h2>
                                            <div class="product-price">
                                                <span>{{ item.GiaBan }}đ</span>
                                                <del>{{ item.GiaKhuyenMai }}đ</del>
                                            </div>
                                            <div class="product-brief">
                                                <p>{{ item.MoTaNgan }}</p>
                                            </div>
                                            <div class="product-hover-action product-hover-action-2">
                                                <ul>
                                                    <li class="add-to-cart">
                                                        <a href="#" title="Add to Cart" data-bs-toggle="modal" data-bs-target="#add_to_cart_modal">
                                                            <span class="{{ item.id }} cart-text d-none d-xl-block">THÊM GIỎ HÀNG</span>
                                                            <span class="d-block d-xl-none"><i class="icon-handbag"></i></span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}

                            </div>
                        </div>
                    </div>
                </div>
                <div class="ltn__pagination-area text-center">
                    <div class="ltn__pagination ltn__pagination-2">
                        <ul>
                            {% if page_count %}
                                {% if page == 1 %}
                                    <li><a href="#"><i class="icon-arrow-left"></i></a></li>
                                {% else %}
                                    <li><a href="{% url 'detail_category' slug=slug %}?trang={{ pre_page }}"><i class="icon-arrow-left"></i></a></li>
                                {% endif %}
                                {% for i in page_count %}
                                    {% if page == i %}
                                        <li class="active"><a href="{% url 'detail_category' slug=slug %}?trang={{ i }}">{{ i }}</a></li>
                                    {% elif page != i %}
                                        <li><a href="{% url 'detail_category' slug=slug %}?trang={{ i }}">{{ i }}</a></li>
                                    {% else %}
                                        <li><a href="{% url 'detail_category' slug=slug %}?trang={{ i }}">{{ i }}</a></li>
                                    {% endif %}
                                {% endfor %}
                                {% if page == page_count %}
                                    <li><a href="#"><i class="icon-arrow-right"></i></a></li>
                                {% elif page == 1 %}
                                    {% if len_page_count == 1 %}
                                        <li><a href="#"><i class="icon-arrow-right"></i></a></li>
                                    {% else %}
                                        <li><a href="{% url 'detail_category' slug=slug %}?trang=2"><i class="icon-arrow-right"></i></a></li>
                                    {% endif %}
                                {% else %}
                                    <li><a href="{% url 'detail_category' slug=slug %}?trang={{ next_page }}"><i class="icon-arrow-right"></i></a></li>
                                {% endif %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        const currentUrl = window.location.href;
        const urlParams = new URLSearchParams(currentUrl);
        if (window.location.search) {
            if (urlParams.has('sap_xep')) {
                $(".sx_tang").attr("href", currentUrl.split('sap_xep')[0] + "sap_xep=tang");
                $(".sx_giam").attr("href", currentUrl.split('sap_xep')[0] + "sap_xep=giam");
                $(".sx_moi").attr("href", currentUrl.split('sap_xep')[0] + "sap_xep=moi");
                return
            }
            $(".sx_tang").attr("href", currentUrl + "&sap_xep=tang");
            $(".sx_giam").attr("href", currentUrl + "&sap_xep=giam");
            $(".sx_moi").attr("href", currentUrl + "&sap_xep=moi");
        } else {
            $(".sx_tang").attr("href", currentUrl.split('?sap_xep')[0] + "?sap_xep=tang");
            $(".sx_giam").attr("href", currentUrl.split('?sap_xep')[0] + "?sap_xep=giam");
            $(".sx_moi").attr("href", currentUrl.split('?sap_xep')[0] + "?sap_xep=moi");
        }

        $('.cart-text').click(function(e){
            var masanpham = $(this).first().attr("class").split(" ")[0]
            $.get("{% url 'add_product_cart' %}", 
                {masanpham}, 
                function(result){
                    var keys = Object.keys(result)
                    if (keys[0] == "error"){
                        alert(result.error)
                        return
                    }
    
                    if (keys[0] == "success"){
                        alert(result.success)
                        window.scrollTo(0, 0);
                        location.reload();
                    }
                }
            );
        })
    });
</script>
{% endblock content%}